function test(table) {
 $('#example tbody').on( 'click', 'button', function () {
        var data = table.row( $(this).parents('tr') ).data();
        console.log(data);
        alert( data[0] +"'s salary is: "+ data[ 5 ] );
 });
}
function draw_datatable(selector,url,is_action=0,is_active=0) {
    var dt_json = {
        "ajax":url,
        "columnDefs":[{'targets': 0,'width': "5%"}]
    }
    var actions_json = { // Icon for Actions
         'targets': -1,
         'searchable': false,
         'orderable': false,
         'width': "10%",
         'data': null,
         'render': function (data, type, full, meta){
               return '<td class="text-right"><button type="button" id="tester" rel="tooltip" class="btn btn-primary btn-link btn-sm btn-icon " data-original-title="Refresh" title=""><i class="tim-icons icon-settings"></i></button><button type="button" rel="tooltip" class="btn btn-warning btn-link btn-sm " data-original-title="Delete" title=""><i class="tim-icons icon-simple-remove"></i></button></td>'
         }
    }
    var active_json = { // Icon for Active/Disabled
         'targets': -2,
         'data': null,
         'searchable': false,
         'orderable': false,
         'width': "1%",
         'render': function (data, type, full, meta){
             var active = data[data.length-1];
             if ( active ) {
               return '<td class="text-right"><button type="button" rel="tooltip" class="btn btn-success btn-link btn-sm btn-icon " data-original-title="Refresh" title=""><i class="tim-icons icon-check-2"></i></button></td>'
             } else {
               return '<td class="text-right"><button type="button" rel="tooltip" class="btn btn-warning btn-link btn-sm btn-icon " data-original-title="Refresh" title=""><i class="tim-icons icon-button-power"></i></button></td>'
             }
         }
    }
    if (is_action) {
        dt_json["columnDefs"].push(actions_json);
    }
    if (is_active) {
        dt_json["columnDefs"].push(active_json);
    }
    var table = $(selector).DataTable(dt_json);
    return table
}

//Register the edit modal
function register_edit(table) {
   $("button#editModal").click(function(e) {
           e.preventDefault();
           ajax_method("/api/agent/data/users?crud=update&filter=id,eq,"+$('#edit-form-id').val(),"POST",JSON.stringify({"email":$('#edit-form-email').val(),"active":$('#edit-form-active').val()}));
           jQuery('#editModal').modal("hide");
           table.ajax.reload();
   });

   $('#example tbody').on('click', 'i.tim-icons.icon-settings', function(e) {
     var data = table.row( $(this).parents('tr') ).data();
     jQuery('#editModal').modal('show');
     jQuery('#editModal').on('shown.bs.modal', function (e) {
          $(e.currentTarget).find('input[name="id"]').val(data[0]);
          $(e.currentTarget).find('input[name="dataEmail"]').val(data[1]);
          $(e.currentTarget).find('input[name="dataActive"]').val(data[2]);
     });
   });

}

function get_column_names(table) {
    var columns = {};
    table.columns().every( function () {
        console.log(this.header().innerHTML);
    });
    return columns
}
//Register the delete modal
function register_delete(table,url) {
     $('#example tbody').on('click', 'i.tim-icons.icon-simple-remove', function(e) {
         var data = table.row( $(this).parents('tr') ).data();
//haaaaa
         get_column_names(table)

         jQuery('#deleteModal').modal('show');
         jQuery('#deleteModal').on('shown.bs.modal', function (e) {
             $("button#deleteModal").click(function() {
                 ajax_method(url+data[0]);
                 jQuery('#deleteModal').modal("hide");
                 table.ajax.reload();
             });
         });
     });
}

// Disable/Enable button
function register_enable(table) {
    $('#example tbody').on('click', 'i.tim-icons.icon-check-2, i.tim-icons.icon-button-power', function(e) {
        var $row = $(this).closest('tr');
        var data = table.row($row).data();
        var active = 1 - data[2];
        ajax_method("/api/agent/data/users?crud=update&filter=id,eq,"+data[0],"POST",JSON.stringify({"active":active}))
        console.log(table.columns().names());
        console.log(table.row().data());

        table.ajax.reload();
    });
}

function button_modal_add(selector) {
   $("button#addModal").click(function(e) {
           e.preventDefault();
           ajax_method("/api/agent/data/users?crud=insert","POST",JSON.stringify({"email":$('#add-form-email').val(),"password":$('#add-form-password').val(),"active":$('#add-form-active').val()}))
           jQuery('#addModal').modal("hide");
   });
}

function ajax_method(url,method="POST",data={}) {
  $.ajax({
         type: method,
         url: url,
         data: data,
         contentType: 'application/json', 
         success: function(result) {
            notify_call(result["message"],result["type"]);
         },
         error: function(result) {
            notify_call("Error","danger");
         }
   });
}
function notify_call(message,type) {
    $.notify({
      // options
      message: message
    },{
      // settings
      type: type
    });
}
