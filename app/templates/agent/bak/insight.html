{% extends "template.html" %}

  {% block head %}
    {{ super() }}

    <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script

    <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css" rel="stylesheet" />
    <link href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css" rel="stylesheet" />
    <script src="https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.html5.min.js"></script>

    <script src="{{url_for('static',filename='assets/js/datatables_template.js')}}"></script>
    <script src="{{url_for('static',filename='assets/js/chartjs_template.js')}}"></script>
    <link href="{{url_for('static',filename='assets/css/table.css')}}" rel="stylesheet" />

  {% endblock %}

  {% block style %}
    {{ super() }}
    .col-md-3.col-sm-4 {
      display: contents;
    }
  {% endblock %}

  {% block body %}
    {% for insight in insights %}

      {% if insight["severity"] <= 4 %}
        {% set color="#5e72e4" %}
      {% elif insight["severity"] <= 4 %}
        {% set color="#2dce89" %}
      {% elif insight["severity"] < 7 %}
        {% set color = "#ffd600" %}
      {% elif insight["severity"] < 9 %}
        {% set color = "#fb6340" %}
      {% else %}
        {% set color = "#f5365c" %}
      {% endif %}
      <div class="row">
        <div class="col-auto text-center flex-column d-none d-sm-flex">
            <div class="row h-50">
                <div class="col border-right">&nbsp;</div>
                <div class="col">&nbsp;</div>
            </div>
            <h5 class="m-2">
                <span class="badge badge-pill bg-success">&nbsp;</span>
            </h5>
            <div class="row h-50">
                <div class="col border-right">&nbsp;</div>
                <div class="col">&nbsp;</div>
            </div>
        </div>
        <div class="col">
            <div class="card border-success shadow">
                <div style="border-left:10px solid {{color}}"class="card-body">
                    <div class="float-right text-success">{{insight["date_added"]}}</div>
                    <span style="font-size:18px;float:left;color:{{color}}" class="badge badge-pill">{{insight["severity"]}}</span>

                    <h4 class="card-title text-white">{{insight["name"]}}</h4>

                    <div class="col-md-3 col-sm-4">
                      <i style="font-size:10px" class="btn btn-simple btn-sm text-teal">E:{{insight["ease"]}}</i>
                    </div>
                    <div class="col-md-3 col-sm-4">
                      <i style="font-size:10px" class="btn btn-simple btn-sm text-teal">C:{{insight["confidence"]}}</i>
                    </div>
                    <p class="card-text">{{insight["description"]}}</p>
                    <button class="btn btn-sm btn-outline-secondary" type="button" data-target="#t{{loop.index}}_details" data-toggle="collapse">Show Details â–¼</button>
                    <button data-id={{insight["id"]}} class="btn btn-sm btn-outline-success" style="float:right" type="button" data-toggle="modal" data-target="#exampleModal">Close</button>

                    <div class="collapse border" id="t{{loop.index}}_details">
                        <div class="p-2 text-monospace">
                            <div>08:30 - 09:00 Breakfast in CR 2A</div>
                            <div>09:00 - 10:30 Live sessions in CR 3</div>
                            <div>10:30 - 10:45 Break</div>
                            <div>10:45 - 12:00 Live sessions in CR 3</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
      </div>
    {% endfor %}
    <!-- Modal -->
    <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">Please confirm</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body text-white">
            Are you sure you want to close this Insight?
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Cancel</button>
            <form method="POST" action="{{url_for(main_ui.close_insight)}}">
            <button id="insight_id" value="" type="button" class="btn btn-warning btn-sm">Confirm</button>
          </div>
        </div>
      </div>
    </div>
  {%endblock%}

  {% block extra_js%}
    <script>
      // add insight ID to the modal
      $('.modal').on('show.bs.modal', function (e) {
        var $btn_id = $(e.relatedTarget).data('id');
        $("#insight_id").attr("value",$btn_id);
      });
    </script>
  {%endblock%}

