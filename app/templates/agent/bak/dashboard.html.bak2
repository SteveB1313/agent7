{% extends "template.html" %}

  {% block head %}
  {{ super() }}

  <script src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script

  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.3/css/bootstrap.css" rel="stylesheet" />
  <link href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css" rel="stylesheet" />

  <script src="{{url_for('static',filename='assets/js/chartjs_template.js')}}"></script>

  <script src="https://cdn.datatables.net/buttons/1.5.6/js/dataTables.buttons.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.flash.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.html5.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.print.min.js"></script>
  <script src="https://cdn.datatables.net/buttons/1.5.6/js/buttons.flash.min.js"></script>

    <script src="{{url_for('static',filename='assets/js/update_template.js')}}"></script>

    <!-- Number counter -->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0.0/jquery.counterup.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>

  <!-- D3 Map -->
  <script src="https://d3js.org/d3.v3.min.js"></script>
  <script src="https://d3js.org/topojson.v0.min.js"></script>
  <script src="{{url_for('static',filename='assets/js/d3.tip.v0.6.3.js')}}"></script>
  {% endblock %}
  {% block style %}
    {{ super() }}

    path {
      stroke: white;
      stroke-width: 0.25px;
      fill: #778899;
    }
  {% endblock %}

  {% block body %}
  {{ super() }}
      <!-- End Navbar -->
        <div class="row">
          <div class="col-lg-3 col-md-6">
            <div class="card card-stats">
              <div class="card-body">
                <div class="row">
                  <div class="col-5">
                    <div class="info-icon text-center icon-info">
                      <i class="tim-icons icon-single-02"></i>
                    </div>
                  </div>
                  <div class="col-7">
                    <div class="numbers">
                      <p class="card-category">Agent</p>
                      <h3 id="top1" class="card-title"></h3>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <hr>
                <div class="stats">
                  <i class="tim-icons icon-minimal-up text-success"></i>Last Week
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6">
            <div class="card card-stats">
              <div class="card-body">
                <div class="row">
                  <div class="col-5">
                    <div class="info-icon text-center icon-danger">
                      <i class="tim-icons icon-molecule-40"></i>
                    </div>
                  </div>
                  <div class="col-7">
                    <div class="numbers">
                      <p class="card-category">Threats</p>
                      <h3 id="top2" class="card-title">2</h3>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <hr>
                <div class="stats">
                  <i class="tim-icons icon-minimal-down text-success"></i>Last Week
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6">
            <div class="card card-stats">
              <div class="card-body">
                <div class="row">
                  <div class="col-5">
                    <div class="info-icon text-center icon-primary" style="background-image:linear-gradient(to bottom left,#edaf05,#fbc531);">
                      <i class="tim-icons icon-planet"></i>
                    </div>
                  </div>
                  <div class="col-7">
                    <div class="numbers">
                      <p class="card-category">Insights</p>
                      <h3 id="top3" class="card-title"></h3>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <hr>
                <div class="stats">
                  <i class="tim-icons icon-minimal-up text-danger"></i>Last Week
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3 col-md-6">
            <div class="card card-stats">
              <div class="card-body">
                <div class="row">
                  <div class="col-5">
                    <div class="info-icon text-center icon-success">
                      <i class="tim-icons icon-trophy"></i>
                    </div>
                  </div>
                  <div class="col-7">
                    <div class="numbers">
                      <p class="card-category">Score</p>
                      <h3 id="top4" class="card-title">400</h3>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-footer">
                <hr>
                <div class="stats">
                  <i class="tim-icons icon-minimal-up text-danger"></i>Last Week
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-6">
            <div class="card card-chart">
              <div class="card-header">
                <h1 class="card-category">Top 5 Agent OS</h1>
                <h3 class="card-title"><i class="tim-icons icon-bulb-63 text-success"></i>Operating Systems</h3>
              </div>
              <div class="card-body">
                <div class="chart-area">
                  <canvas id="chart1"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card card-chart">
              <div class="card-header">
                <h5 class="card-category">Top 5 Agent Versions</h5>
                <h3 class="card-title"><i class="tim-icons icon-send text-success"></i>Version</h3>
              </div>
              <div class="card-body">
                <div class="chart-area">
                  <canvas id="chart2"></canvas>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-3">
            <div class="card card-chart">
              <div class="card-header">
                <h5 class="card-category">Top 5 Agent Domains</h5>
                <h3 class="card-title"><i class="tim-icons icon-send text-success"></i>Domain</h3>
              </div>
              <div class="card-body">
                <div class="chart-area">
                  <canvas id="chart3"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-7">
            <div style="height:600px" class="card card-chart">
              <div class="card-header">
                <h1 class="card-category">Geographic location of the hosts</h1>
                <h3 class="card-title"><i class="tim-icons icon-bulb-63 text-success"></i>Host Location</h3>
              </div>
              <div class="card-body">
                <div class="chart-area">
                  <div id="map"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-lg-5">
            <div class="card card-chart">
              <div class="card-header">
                <h5 class="card-category">Top 5 Regions</h5>
                <h3 class="card-title"><i class="tim-icons icon-send text-success"></i>Top Host Region</h3>
              </div>
              <div class="card-body">
                <div class="chart-area">
                  <canvas id="chart4"></canvas>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
  {% endblock %}

{% block extra_js %}
<!-- Place Scripts here -->
<script>
    $(document).ready(function (){
        $.noConflict();
        var up = update_init(
            selector="#top1",
            url="/api/agent/data/agent?getcount=true",
            animate=1, // animate the increment
        );
        var up = update_init(
            selector="#top3",
            url="/api/agent/data/insight?getcount=true",
            animate=1, // animate the increment
        );

        // draw chartjs
        var table1 = cjs_init(
            selector="chart1",
            url="{{url_for('agent_api.get_agent_events',model='agent')}}?as_chartjs=true&groupby=edition,count&limit=5",
            type="doughnut", // type of graph (line,pie,bar,doughnut,polarArea)
            graph_label="Chart1", // header of graph
        );  
        // draw chartjs
        var table2 = cjs_init(
            selector="chart2",
            url="{{url_for('agent_api.get_agent_events',model='agent')}}?as_chartjs=true&groupby=version,count&limit=5",
            type="doughnut", // type of graph (line,pie,bar,doughnut,polarArea)
            graph_label="Chart2", // header of graph
        );  
        // draw chartjs
        var table3 = cjs_init(
            selector="chart3",
            url="{{url_for('agent_api.get_agent_events',model='agent')}}?as_chartjs=true&groupby=domain,count&limit=5",
            type="doughnut", // type of graph (line,pie,bar,doughnut,polarArea)
            graph_label="Chart3", // header of graph
        );  
        var table4 = cjs_init(
            selector="chart4",
            url="{{url_for('agent_api.get_agent_events',model='agent')}}?as_chartjs=true&groupby=region_name,count&limit=5",
            type="horizontalBar", // type of graph (line,pie,bar,doughnut,polarArea)
            graph_label="Region", // header of graph
        );  
    });
</script>
<script>
//haaaaaa
var cities = {{data|safe}}

var width = 950,
    height = 550;

var projection = d3.geo.mercator()
    .center([40,34]) //long and lat starting position
//    .center([10,20]) //long and lat starting position
  //  .scale(100) //starting zoom position
  //  .rotate([10,0]); //where world split occurs

var svg = d3.select("#map").append("svg")
    .attr("width", width)
    .attr("height", height);

var path = d3.geo.path()
    .projection(projection);

var g = svg.append("g");

// load and display the world and locations
d3.json("{{ url_for('static', filename='assets/world-110m2.json') }}", function(error, topology) {

var world = g.selectAll("path")
				.data(topojson.object(topology, topology.objects.countries).geometries)
				.enter()
				.append("path")
                                .style("fill", "grey")
  			        .style("opacity", 0.6)
				.attr("d", path)


// add city location circles
var locations = g.selectAll("circle")
			       .data(cities)
			       .enter()
			       .append("circle")
			       .attr("cx", function(d) {return projection([d.lon, d.lat])[0];})
			       .attr("cy", function(d) {return projection([d.lon, d.lat])[1];})
			       .attr("r", 4)
			       .style("fill", "blue")
			       .style("opacity", 0.6)
			       ;
    
});
  


//zoom and pan functionality
var zoom = d3.behavior.zoom()
    .on("zoom",function() {
        g.attr("transform","translate("+ 
            d3.event.translate.join(",")+")scale("+d3.event.scale+")");
        g.selectAll("path")  
            .attr("d", path.projection(projection)); 
  });
svg.call(zoom);
</script>
{% endblock %}
